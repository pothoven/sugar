/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notifcation.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a,b){a.widget("mobile.datebox",a.mobile.widget,{options:{theme:"c",pickPageTheme:"b",pickPageInputTheme:"e",pickPageButtonTheme:"a",pickPageHighButtonTheme:"e",pickPageOHighButtonTheme:"e",pickPageODHighButtonTheme:"e",pickPageTodayButtonTheme:"e",pickPageSlideButtonTheme:"d",pickPageFlipButtonTheme:"b",centerWindow:!1,calHighToday:!0,calHighPicked:!0,noAnimation:!1,disableManualInput:!1,disabled:!1,wheelExists:!1,swipeEnabled:!0,zindex:"500",debug:!1,setDateButtonLabel:"Set Date",setTimeButtonLabel:"Set Time",setDurationButtonLabel:"Set Duration",calTodayButtonLabel:"Jump to Today",titleDateDialogLabel:"Set Date",titleTimeDialogLabel:"Set Time",titleDialogLabel:!1,meridiemLetters:["AM","PM"],daysOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysOfWeekShort:["Su","Mo","Tu","We","Th","Fr","Sa"],monthsOfYear:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsOfYearShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],durationLabel:["Days","Hours","Minutes","Seconds"],durationDays:["Day","Days"],timeFormat:24,timeFormats:{12:"gg:ii AA",24:"HH:ii"},timeOutput:!1,rolloverMode:{m:!0,d:!0,h:!0,i:!0,s:!0},mode:"datebox",calShowDays:!0,calShowOnlyMonth:!1,useDialogForceTrue:!1,useDialogForceFalse:!1,useDialog:!1,useModal:!1,useInline:!1,noButtonFocusMode:!1,noButton:!1,noSetButton:!1,closeCallback:!1,open:!1,nestedBox:!1,fieldsOrder:!1,dateFieldOrder:["m","d","y"],timeFieldOrder:["h","i","a"],slideFieldOrder:["y","m","d"],durationOrder:["d","h","i","s"],headerFormat:"ddd, mmm dd, YYYY",dateFormat:"YYYY-MM-DD",minuteStep:1,calTodayButton:!1,calWeekMode:!1,calWeekModeFirstDay:1,calWeekModeHighlight:!0,calStartDay:0,defaultPickerValue:!1,defaultDate:!1,minYear:!1,maxYear:!1,afterToday:!1,beforeToday:!1,maxDays:!1,minDays:!1,highDays:!1,highDates:!1,blackDays:!1,blackDates:!1,durationNoDays:!1,durationNoSeconds:!1,durationShort:!0,durationSteppers:{d:1,h:1,i:1,s:1},disabledDayColor:"#888"},_dateboxHandler:function(b,c){if(!b.isPropagationStopped())switch(c.method){case"close":a(this).data("datebox").close();break;case"open":a(this).data("datebox").open();break;case"set":a(this).val(c.value),a(this).trigger("change");break;case"doset":a(this).data("datebox").options.mode==="timebox"||a(this).data("datebox").options.mode==="durationbox"?a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatTime(a(this).data("datebox").theDate)}):a(this).trigger("datebox",{method:"set",value:a(this).data("datebox")._formatDate(a(this).data("datebox").theDate)});case"dooffset":a(this).data("datebox")._offset(c.type,c.amount,!0);break;case"dorefresh":a(this).data("datebox")._update()}},_zeroPad:function(a){return(a<10?"0":"")+String(a)},_makeOrd:function(a){var b=a%10;return a>9&&a<21?"th":b>3?"th":["th","st","nd","rd"][b]},_isInt:function(a){return a.toString().search(/^[0-9]+$/)===0},_dstAdjust:function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},_getFirstDay:function(a){return(new Date(a.getFullYear(),a.getMonth(),1)).getDay()},_getLastDate:function(a){return 32-this._dstAdjust(new Date(a.getFullYear(),a.getMonth(),32)).getDate()},_getLastDateBefore:function(a){return 32-this._dstAdjust(new Date(a.getFullYear(),a.getMonth()-1,32)).getDate()},_formatter:function(a,b){return a=a.replace("SS",this._makeOrd(b.getDate())),a=a.replace("YYYY",b.getFullYear()),a=a.replace("mmm",this.options.monthsOfYear[b.getMonth()]),a=a.replace("MM",this._zeroPad(b.getMonth()+1)),a=a.replace("mm",b.getMonth()+1),a=a.replace("ddd",this.options.daysOfWeek[b.getDay()]),a=a.replace("DD",this._zeroPad(b.getDate())),a=a.replace("dd",b.getDate()),a=a.replace("HH",this._zeroPad(b.getHours())),a=a.replace("GG",b.getHours()),a=a.replace("hh",this._zeroPad(b.getHours()===0||b.getHours()===12?12:b.getHours()<12?b.getHours():b.getHours()-12)),a=a.replace("gg",b.getHours()===0||b.getHours()===12?12:b.getHours()<12?b.getHours():b.getHours()-12),a=a.replace("ii",this._zeroPad(b.getMinutes())),a=a.replace("ss",this._zeroPad(b.getSeconds())),a=a.replace("AA",b.getHours()<12?this.options.meridiemLetters[0].toUpperCase():this.options.meridiemLetters[1].toUpperCase()),a=a.replace("aa",b.getHours()<12?this.options.meridiemLetters[0].toLowerCase():this.options.meridiemLetters[1].toLowerCase()),a},_formatHeader:function(a){return this._formatter(this.options.headerFormat,a)},_formatDate:function(a){return this._formatter(this.options.dateFormat,a)},_isoDate:function(a,b,c){return String(a)+"-"+(b<10?"0":"")+String(b)+"-"+(c<10?"0":"")+String(c)},_formatTime:function(a){var b=this,c,d,e,f="";return this.options.mode==="durationbox"?(d=(b.theDate.getTime()-b.theDate.getMilliseconds())/1e3-(b.initDate.getTime()-b.initDate.getMilliseconds())/1e3,e=parseInt(d/86400,10),b.options.durationNoDays||(f=e===0?"":String(e)+" "+(e>1?this.options.durationDays[1]:this.options.durationDays[0])+", ",d=d-e*60*60*24),c=parseInt(d/3600,10),d=d-c*60*60,e=parseInt(d/60,10),d=d-e*60,b.options.durationShort?f+(c>0||f!==""?b._zeroPad(c)+":":"")+(e>0||c>0||f!==""?b._zeroPad(e):"")+(b.options.durationNoSeconds?"":":"+(e>0||c>0||f!=="")?b._zeroPad(parseInt(d,10)):String(d)):f+b._zeroPad(c)+":"+b._zeroPad(e)+(b.options.durationNoSeconds?"":":"+b._zeroPad(parseInt(d,10)))):this._formatter(b.options.timeOutput,a)},_makeDate:function(b){b=a.trim(b);var c=this.options,d=this,e=null,f=null,g=null,h=null,i=new Date,j=0,k=/^(?:([0-9]+) .+, )?(?:([0-9]+):)?(?:([0-9]+):)?([0-9]+)$/i,l=null,m;if(c.mode==="durationbox")return l=k.exec(b),l===null?typeof c.defaultPickerValue=="number"&&c.defaultPickerValue>0?new Date(d.initDate.getTime()+parseInt(c.defaultPickerValue,10)*1e3):new Date(d.initDate.getTime()):(d.options.durationNoSeconds?(j=(d.initDate.getTime()-d.initDate.getMilliseconds())/1e3+parseInt(l[4],10)*60,typeof l[3]!="undefined"&&(j=j+parseInt(l[3],10)*60*60),typeof l[2]!="undefined"&&(typeof l[3]=="undefined"?j=j+parseInt(l[2],10)*60*60:j=j+parseInt(l[2],10)*60*60*24),typeof l[1]!="undefined"&&(j=j+parseInt(l[1],10)*60*60*24)):(j=(d.initDate.getTime()-d.initDate.getMilliseconds())/1e3+parseInt(l[4],10),typeof l[3]!="undefined"&&(j=j+parseInt(l[3],10)*60),typeof l[2]!="undefined"&&(typeof l[3]=="undefined"?j=j+parseInt(l[2],10)*60:j=j+parseInt(l[2],10)*60*60),typeof l[1]!="undefined"&&(j=j+parseInt(l[1],10)*60*60*24)),j=j*1e3,new Date(j));c.mode==="timebox"||c.mode==="timeflipbox"?e=c.timeOutput:e=c.dateFormat,e=e.replace(/ddd|SS/g,".+?"),e=e.replace(/mmm/g,"(.+?)"),e=e.replace(/ *AA/g," *(.*?)"),e=e.replace(/yyyy|dd|mm|gg|hh|ii/ig,"([0-9yYdDmMgGhHi]+)"),e=e.replace(/ss/g,"([0-9s]+)"),e=RegExp("^"+e+"$"),f=e.exec(b),c.mode==="timebox"||c.mode==="timeflipbox"?g=e.exec(c.timeOutput):g=e.exec(c.dateFormat),c.debug&&console.log({info:"EXPERIMENTAL REGEX MODE ENABLED",string:b,regex:e,input:f,format:g});if(f===null||f.length!==g.length){if(c.defaultPickerValue!==!1){if(a.isArray(c.defaultPickerValue)&&c.defaultPickerValue.length===3){if(c.mode==="timebox"||c.mode==="timeflipbox"){var n=new Date;return new Date(n.getYear(),n.getMonth(),n.getDate(),c.defaultPickerValue[0],c.defaultPickerValue[1],c.defaultPickerValue[2],0)}return new Date(c.defaultPickerValue[0],c.defaultPickerValue[1],c.defaultPickerValue[2],0,0,0,0)}if(c.mode==="timebox"||c.mode==="timeflipbox"){h=c.defaultPickerValue.split(":");if(h.length===3){var n=new Date;i=new Date(n.getYear(),n.getMonth(),n.getDate(),parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10),0),isNaN(i.getDate())&&(i=new Date)}}else h=c.defaultPickerValue.split("-"),h.length===3&&(i=new Date(parseInt(h[0],10),parseInt(h[1],10)-1,parseInt(h[2],10),0,0,0,0),isNaN(i.getDate())&&(i=new Date))}}else for(m=0;m<f.length;m++)g[m].match(/^gg$/i)&&i.setHours(parseInt(f[m],10)),g[m].match(/^hh$/i)&&i.setHours(parseInt(f[m],10)),g[m].match(/^ii$/i)&&i.setMinutes(parseInt(f[m],10)),g[m].match(/^ss$/)&&i.setSeconds(parseInt(f[m],10)),g[m].match(/^dd$/i)&&i.setDate(parseInt(f[m],10)),g[m].match(/^mm$/i)&&i.setMonth(parseInt(f[m],10)-1),g[m].match(/^yyyy$/i)&&i.setYear(parseInt(f[m],10)),g[m].match(/^AA$/i)&&(f[m].toLowerCase().charAt(0)==="a"&&i.getHours()===12?i.setHours(0):f[m].toLowerCase().charAt(0)==="p"&&i.getHours()!==12&&i.setHours(i.getHours()+12)),g[m].match(/^mmm$/i)&&(h=a.inArray(f[m],c.monthsOfYear),h>-1&&i.setMonth(h));return g[0].match(/G|g|i|s|H|h|A/)?i:new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0)},_checker:function(a){return parseInt(String(a.getFullYear())+this._zeroPad(a.getMonth()+1)+this._zeroPad(a.getDate()),10)},_hoover:function(b){a(b).toggleClass("ui-btn-up-"+a(b).attr("data-theme")+" ui-btn-down-"+a(b).attr("data-theme"))},_offset:function(a,b,c){var d=this,e=this.options;typeof c=="undefined"&&(c=!0),d.input.trigger("datebox",{method:"offset",type:a,amount:b});switch(a){case"y":d.theDate.setYear(d.theDate.getFullYear()+b);break;case"m":console.log(e.rolloverMode),(e.rolloverMode.m||d.theDate.getMonth()+b<12&&d.theDate.getMonth()+b>-1)&&d.theDate.setMonth(d.theDate.getMonth()+b);break;case"d":(e.rolloverMode.d||d.theDate.getDate()+b>0&&d.theDate.getDate()+b<d._getLastDate(d.theDate)+1)&&d.theDate.setDate(d.theDate.getDate()+b);break;case"h":(e.rolloverMode.h||d.theDate.getHours()+b>-1&&d.theDate.getHours()+b<24)&&d.theDate.setHours(d.theDate.getHours()+b);break;case"i":(e.rolloverMode.i||d.theDate.getMinutes()+b>-1&&d.theDate.getMinutes()+b<60)&&d.theDate.setMinutes(d.theDate.getMinutes()+b);break;case"s":(e.rolloverMode.i||d.theDate.getSeconds()+b>-1&&d.theDate.getSeconds()+b<60)&&d.theDate.setSeconds(d.theDate.getSeconds()+b);break;case"a":d.pickerMeri.val()===e.meridiemLetters[0]?d._offset("h",12,!1):d._offset("h",-12,!1)}c===!0&&d._update()},_updateduration:function(){var a=this,b=(a.initDate.getTime()-a.initDate.getMilliseconds())/1e3;a._isInt(a.pickerDay.val())||a.pickerDay.val(0),a._isInt(a.pickerHour.val())||a.pickerHour.val(0),a._isInt(a.pickerMins.val())||a.pickerMins.val(0),a._isInt(a.pickerSecs.val())||a.pickerSecs.val(0),b=b+parseInt(a.pickerDay.val(),10)*60*60*24,b=b+parseInt(a.pickerHour.val(),10)*60*60,b=b+parseInt(a.pickerMins.val(),10)*60,b=b+parseInt(a.pickerSecs.val(),10),a.theDate.setTime(b*1e3),a._update()},_update:function(){var b=this,c=b.options,d=null,e,f,g,h,i,j,k,l,m,n,o={d:86400,h:3600,i:60,s:1},p={};b.input.trigger("datebox",{method:"refresh"}),c.mode==="durationbox"&&(e=(b.theDate.getTime()-b.theDate.getMilliseconds())/1e3-(b.initDate.getTime()-b.initDate.getMilliseconds())/1e3,e<0&&(e=0,b.theDate.setTime(b.initDate.getTime())),j=parseInt(e/o.d,10),e=e-j*o.d,b.pickerDay.val(j),j=parseInt(e/o.h,10),e=e-j*o.h,b.pickerHour.val(j),j=parseInt(e/o.i,10),e=e-j*o.i,b.pickerMins.val(j),b.pickerSecs.val(parseInt(e,10))),c.mode==="timebox"&&(c.minuteStep!==1&&(e=b.theDate.getMinutes()%c.minuteStep,e!==0&&b.theDate.setMinutes(b.theDate.getMinutes()-e)),b.pickerMins.val(b._zeroPad(b.theDate.getMinutes())),c.timeFormat===12?b.theDate.getHours()>11?(b.pickerMeri.val(c.meridiemLetters[1]),b.theDate.getHours()===12?b.pickerHour.val(12):b.pickerHour.val(b.theDate.getHours()-12)):(b.pickerMeri.val(c.meridiemLetters[0]),b.theDate.getHours()===0?b.pickerHour.val(12):b.pickerHour.val(b.theDate.getHours())):b.pickerHour.val(b.theDate.getHours()));if(c.mode==="flipbox"||c.mode==="timeflipbox"){c.afterToday!==!1&&(d=new Date,b.theDate<d&&(b.theDate=d)),c.maxDays!==!1&&(d=new Date,d.setDate(d.getDate()+c.maxDays),b.theDate>d&&(b.theDate=d)),c.minDays!==!1&&(d=new Date,d.setDate(d.getDate()-c.minDays),b.theDate<d&&(b.theDate=d)),c.maxYear!==!1&&(d=new Date(c.maxYear,0,1),d.setDate(d.getDate()-1),b.theDate>d&&(b.theDate=d)),c.minYear!==!1&&(d=new Date(c.minYear,0,1),b.theDate<d&&(b.theDate=d)),l=b._makeDate(b.input.val()),b.controlsHeader.html(b._formatHeader(b.theDate));for(j=0;j<c.fieldsOrder.length;j++){n=!0;switch(c.fieldsOrder[j]){case"y":i=b.pickerYar.find("ul"),i.html("");for(e=-15;e<16;e++)k=l.getFullYear()===b.theDate.getFullYear()+e?c.pickPageHighButtonTheme:c.pickPageFlipButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<li>",{"class":"ui-body-"+k,style:""+(n===!0?"margin-top: -453px":"")}).html("<span>"+(b.theDate.getFullYear()+e)+"</span>").attr("data-offset",e).attr("data-theme",k).appendTo(i),n===!0&&(n=!1);break;case"m":i=b.pickerMon.find("ul"),i.html("");for(e=-12;e<13;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),1),d.setMonth(d.getMonth()+e),k=l.getMonth()===d.getMonth()&&l.getYear()===d.getYear()?c.pickPageHighButtonTheme:c.pickPageFlipButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<li>",{"class":"ui-body-"+k,style:""+(n===!0?"margin-top: -357px":"")}).attr("data-offset",e).attr("data-theme",k).html("<span>"+c.monthsOfYearShort[d.getMonth()]+"</span>").appendTo(i),n===!0&&(n=!1);break;case"d":i=b.pickerDay.find("ul"),i.html("");for(e=-15;e<16;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate()),d.setDate(d.getDate()+e),k=l.getDate()===d.getDate()&&l.getMonth()===d.getMonth()&&l.getYear()===d.getYear()?c.pickPageHighButtonTheme:c.pickPageFlipButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<li>",{"class":"ui-body-"+k,style:""+(n===!0?"margin-top: -453px":"")}).attr("data-offset",e).attr("data-theme",k).html("<span>"+d.getDate()+"</span>").appendTo(i),n===!0&&(n=!1);break;case"h":i=b.pickerHour.find("ul"),i.html("");for(e=-12;e<13;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),b.theDate.getHours()),d.setHours(d.getHours()+e),k=e===0?c.pickPageButtonTheme:c.pickPageFlipButtonTheme,a("<li>",{"class":"ui-body-"+k,style:""+(n===!0?"margin-top: -357px":"")}).attr("data-offset",e).attr("data-theme",k).html("<span>"+(c.timeFormat===12?d.getHours()===0?"12":d.getHours()<12?d.getHours():d.getHours()===12?"12":d.getHours()-12:d.getHours())+"</span>").appendTo(i),n===!0&&(n=!1);break;case"i":i=b.pickerMins.find("ul"),i.html("");for(e=-30;e<31;e++)c.minuteStep>1&&b.theDate.setMinutes(b.theDate.getMinutes()-b.theDate.getMinutes()%c.minuteStep),d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),b.theDate.getHours(),b.theDate.getMinutes()),d.setMinutes(d.getMinutes()+e*c.minuteStep),k=e===0?c.pickPageButtonTheme:c.pickPageFlipButtonTheme,a("<li>",{"class":"ui-body-"+k,style:""+(n===!0?"margin-top: -933px":"")}).attr("data-offset",e*c.minuteStep).attr("data-theme",k).html("<span>"+b._zeroPad(d.getMinutes())+"</span>").appendTo(i),n===!0&&(n=!1);break;case"a":i=b.pickerMeri.find("ul"),i.html(""),b.theDate.getHours()>11?(n="-65",k=[c.pickPageFlipButtonTheme,c.pickPageButtonTheme]):(n="-33",k=[c.pickPageButtonTheme,c.pickPageFlipButtonTheme]),a("<li>").appendTo(i).clone().appendTo(i),a("<li>",{"class":"ui-body-"+k[0],style:"margin-top: "+n+"px"}).attr("data-offset",1).attr("data-theme",k[0]).html("<span>"+c.meridiemLetters[0]+"</span>").appendTo(i),a("<li>",{"class":"ui-body-"+k[1]}).attr("data-offset",1).attr("data-theme",k[1]).html("<span>"+c.meridiemLetters[1]+"</span>").appendTo(i),a("<li>").appendTo(i).clone().appendTo(i)}}}if(c.mode==="slidebox"){c.afterToday!==!1&&(d=new Date,b.theDate<d&&(b.theDate=d)),c.maxDays!==!1&&(d=new Date,d.setDate(d.getDate()+c.maxDays),b.theDate>d&&(b.theDate=d)),c.minDays!==!1&&(d=new Date,d.setDate(d.getDate()-c.minDays),b.theDate<d&&(b.theDate=d)),c.maxYear!==!1&&(d=new Date(c.maxYear,0,1),d.setDate(d.getDate()-1),b.theDate>d&&(b.theDate=d)),c.minYear!==!1&&(d=new Date(c.minYear,0,1),b.theDate<d&&(b.theDate=d)),l=b._makeDate(b.input.val()),b.controlsHeader.html(b._formatHeader(b.theDate)),b.controlsInput.html("");for(j=0;j<c.fieldsOrder.length;j++){m=a("<div>",{"data-rowtype":c.fieldsOrder[j]}),c.wheelExists&&m.bind("mousewheel",function(c,d){c.preventDefault(),b._offset(a(this).attr("data-rowtype"),d>0?1:-1)}),i=a("<div>",{"class":"ui-datebox-sliderow-int","data-rowtype":c.fieldsOrder[j]}).appendTo(m),c.swipeEnabled&&i.bind(b.START_DRAG,function(c){b.dragMove||(b.dragMove=!0,b.dragTarget=a(this),b.dragPos=parseInt(b.dragTarget.css("marginLeft").replace(/px/i,""),10),b.dragStart=b.touch?c.originalEvent.changedTouches[0].pageX:c.pageX,b.dragEnd=!1,c.stopPropagation(),c.preventDefault())});switch(c.fieldsOrder[j]){case"y":m.addClass("ui-datebox-sliderow-ym"),i.css("marginLeft","-333px");for(e=-5;e<6;e++)k=l.getFullYear()===b.theDate.getFullYear()+e?c.pickPageHighButtonTheme:c.pickPageSlideButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<div>",{"class":"ui-datebox-slideyear ui-corner-all ui-btn-up-"+k}).text(b.theDate.getFullYear()+e).attr("data-offset",e).attr("data-theme",k).bind("vmouseover vmouseout",function(){b._hoover(this)}).bind("vclick",function(c){c.preventDefault(),b._offset("y",parseInt(a(this).attr("data-offset"),10))}).appendTo(i);break;case"m":m.addClass("ui-datebox-sliderow-ym"),i.css("marginLeft","-204px");for(e=-6;e<7;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),1),d.setMonth(d.getMonth()+e),k=l.getMonth()===d.getMonth()&&l.getYear()===d.getYear()?c.pickPageHighButtonTheme:c.pickPageSlideButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<div>",{"class":"ui-datebox-slidemonth ui-corner-all ui-btn-up-"+k}).attr("data-offset",e).attr("data-theme",k).text(c.monthsOfYearShort[d.getMonth()]).bind("vmouseover vmouseout",function(){b._hoover(this)}).bind("vclick",function(c){c.preventDefault(),b._offset("m",parseInt(a(this).attr("data-offset"),10))}).appendTo(i);break;case"d":m.addClass("ui-datebox-sliderow-d"),i.css("marginLeft","-386px");for(e=-15;e<16;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate()),d.setDate(d.getDate()+e),k=l.getDate()===d.getDate()&&l.getMonth()===d.getMonth()&&l.getYear()===d.getYear()?c.pickPageHighButtonTheme:c.pickPageSlideButtonTheme,e===0&&(k=c.pickPageButtonTheme),a("<div>",{"class":"ui-datebox-slideday ui-corner-all ui-btn-up-"+k}).attr("data-offset",e).attr("data-theme",k).html(d.getDate()+'<br /><span class="ui-datebox-slidewday">'+c.daysOfWeekShort[d.getDay()]+"</span>").bind("vmouseover vmouseout",function(){b._hoover(this)}).bind("vclick",function(c){c.preventDefault(),b._offset("d",parseInt(a(this).attr("data-offset"),10))}).appendTo(i);break;case"h":m.addClass("ui-datebox-sliderow-hi"),i.css("marginLeft","-284px");for(e=-12;e<13;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),b.theDate.getHours()),d.setHours(d.getHours()+e),k=e===0?c.pickPageButtonTheme:c.pickPageSlideButtonTheme,a("<div>",{"class":"ui-datebox-slidehour ui-corner-all ui-btn-up-"+k}).attr("data-offset",e).attr("data-theme",k).html(c.timeFormat===12?d.getHours()===0?'12<span class="ui-datebox-slidewday">AM</span>':d.getHours()<12?d.getHours()+'<span class="ui-datebox-slidewday">AM</span>':d.getHours()===12?'12<span class="ui-datebox-slidewday">PM</span>':d.getHours()-12+'<span class="ui-datebox-slidewday">PM</span>':d.getHours()).bind("vmouseover vmouseout",function(){b._hoover(this)}).bind("vclick",function(c){c.preventDefault(),b._offset("h",parseInt(a(this).attr("data-offset"),10))}).appendTo(i);break;case"i":m.addClass("ui-datebox-sliderow-hi"),i.css("marginLeft","-896px");for(e=-30;e<31;e++)d=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),b.theDate.getHours(),b.theDate.getMinutes()),d.setMinutes(d.getMinutes()+e),k=e===0?c.pickPageButtonTheme:c.pickPageSlideButtonTheme,a("<div>",{"class":"ui-datebox-slidemins ui-corner-all ui-btn-up-"+k}).attr("data-offset",e).attr("data-theme",k).text(b._zeroPad(d.getMinutes())).bind("vmouseover vmouseout",function(){b._hoover(this)}).bind("vclick",function(c){c.preventDefault(),b._offset("i",parseInt(a(this).attr("data-offset"),10))}).appendTo(i)}m.appendTo(b.controlsInput)}}c.mode==="datebox"&&(c.afterToday!==!1&&(d=new Date,b.theDate<d&&(b.theDate=d)),c.beforeToday!==!1&&(d=new Date,b.theDate>d&&(b.theDate=d)),c.maxDays!==!1&&(d=new Date,d.setDate(d.getDate()+c.maxDays),b.theDate>d&&(b.theDate=d)),c.minDays!==!1&&(d=new Date,d.setDate(d.getDate()-c.minDays),b.theDate<d&&(b.theDate=d)),c.maxYear!==!1&&(d=new Date(c.maxYear,0,1),d.setDate(d.getDate()-1),b.theDate>d&&(b.theDate=d)),c.minYear!==!1&&(d=new Date(c.minYear,0,1),b.theDate<d&&(b.theDate=d)),b.controlsHeader.html(b._formatHeader(b.theDate)),b.pickerMon.val(b.theDate.getMonth()+1),b.pickerDay.val(b.theDate.getDate()),b.pickerYar.val(b.theDate.getFullYear()));if(c.mode==="calbox"){b.controlsInput.text(c.monthsOfYear[b.theDate.getMonth()]+" "+b.theDate.getFullYear()),b.controlsSet.html(""),p={today:-1,highlightDay:-1,presetDay:-1,nexttoday:1,thisDate:new Date,maxDate:new Date,minDate:new Date,currentMonth:!1,weekMode:0,weekDays:null,thisTheme:c.pickPageButtonTheme},p.start=b._getFirstDay(b.theDate),p.end=b._getLastDate(b.theDate),p.lastend=b._getLastDateBefore(b.theDate),p.presetDate=b._makeDate(b.input.val()),c.calStartDay>0&&(p.start=p.start-c.calStartDay,p.start<0&&(p.start=p.start+7)),p.prevtoday=p.lastend-(p.start-1),p.checkDates=c.afterToday!==!1||c.beforeToday!==!1||c.notToday!==!1||c.maxDays!==!1||c.minDays!==!1||c.blackDates!==!1||c.blackDays!==!1,p.thisDate.getMonth()===b.theDate.getMonth()&&p.thisDate.getFullYear()===b.theDate.getFullYear()&&(p.currentMonth=!0,p.highlightDay=p.thisDate.getDate()),b._checker(p.presetDate)===b._checker(b.theDate)&&(p.presetDay=p.presetDate.getDate()),b.calNoPrev=!1,b.calNoNext=!1,c.afterToday===!0&&(p.currentMonth===!0||p.thisDate.getMonth()>=b.theDate.getMonth()&&b.theDate.getFullYear()===p.thisDate.getFullYear())&&(b.calNoPrev=!0),c.beforeToday===!0&&(p.currentMonth===!0||p.thisDate.getMonth()<=b.theDate.getMonth()&&b.theDate.getFullYear()===p.thisDate.getFullYear())&&(b.calNoNext=!0),c.minDays!==!1&&(p.minDate.setDate(p.minDate.getDate()-c.minDays),b.theDate.getFullYear()===p.minDate.getFullYear()&&b.theDate.getMonth()<=p.minDate.getMonth()&&(b.calNoPrev=!0)),c.maxDays!==!1&&(p.maxDate.setDate(p.maxDate.getDate()+c.maxDays),b.theDate.getFullYear()===p.maxDate.getFullYear()&&b.theDate.getMonth()>=p.maxDate.getMonth()&&(b.calNoNext=!0));if(c.calShowDays){c.daysOfWeekShort.length<8&&(c.daysOfWeekShort=c.daysOfWeekShort.concat(c.daysOfWeekShort)),p.weekDays=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(b.controlsSet);for(e=0;e<=6;e++)a("<div>"+c.daysOfWeekShort[e+c.calStartDay]+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty ui-datebox-griddate-label").appendTo(p.weekDays)}for(f=0;f<=5;f++)if(f===0||f>0&&p.today>0&&p.today<=p.end){i=a("<div>",{"class":"ui-datebox-gridrow"}).appendTo(b.controlsSet);for(g=0;g<=6;g++)g===0&&(p.weekMode=p.today<1?p.prevtoday-p.lastend+c.calWeekModeFirstDay:p.today+c.calWeekModeFirstDay),g===p.start&&f===0&&(p.today=1),p.today>p.end&&(p.today=-1),p.today<1?c.calShowOnlyMonth?a("<div>",{"class":"ui-datebox-griddate ui-datebox-griddate-empty"}).appendTo(i):(c.blackDays!==!1&&a.inArray(g,c.blackDays)>-1||c.blackDates!==!1&&a.inArray(b._isoDate(b.theDate.getFullYear(),b.theDate.getMonth(),p.prevtoday),c.blackDates)>-1||c.blackDates!==!1&&a.inArray(b._isoDate(b.theDate.getFullYear(),b.theDate.getMonth()+2,p.nexttoday),c.blackDates)>-1?h=!0:h=!1,f===0?(a("<div>"+String(p.prevtoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(i).attr("data-date",c.calWeekMode?p.weekMode+p.lastend:p.prevtoday).bind(h?"error":"vclick",function(c){c.preventDefault(),b.calNoPrev||(b.theDate.setMonth(b.theDate.getMonth()-1),b.theDate.setDate(a(this).attr("data-date")),b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"}))}),p.prevtoday++):(a("<div>"+String(p.nexttoday)+"</div>").addClass("ui-datebox-griddate ui-datebox-griddate-empty").appendTo(i).attr("data-date",c.calWeekMode?p.weekMode:p.nexttoday).bind(h?"error":"vclick",function(d){d.preventDefault(),b.calNoNext||(b.theDate.setDate(a(this).attr("data-date")),c.calWeekMode||b.theDate.setMonth(b.theDate.getMonth()+1),b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"}))}),p.nexttoday++)):(h=!1,p.checkDates&&(c.afterToday&&b._checker(p.thisDate)>b._checker(b.theDate)+p.today-b.theDate.getDate()&&(h=!0),!h&&c.beforeToday&&b._checker(p.thisDate)<b._checker(b.theDate)+p.today-b.theDate.getDate()&&(h=!0),!h&&c.notToday&&p.today===p.highlightDay&&(h=!0),!h&&c.maxDays!==!1&&b._checker(p.maxDate)<b._checker(b.theDate)+p.today-b.theDate.getDate()&&(h=!0),!h&&c.minDays!==!1&&b._checker(p.minDate)>b._checker(b.theDate)+p.today-b.theDate.getDate()&&(h=!0),!h&&(c.blackDays!==!1||c.blackDates!==!1)&&(a.inArray(g,c.blackDays)>-1||a.inArray(b._isoDate(b.theDate.getFullYear(),b.theDate.getMonth()+1,p.today),c.blackDates)>-1)&&(h=!0)),c.calHighPicked&&p.today===p.presetDay?p.thisTheme=c.pickPageHighButtonTheme:c.calHighToday&&p.today===p.highlightDay?p.thisTheme=c.pickPageTodayButtonTheme:a.isArray(c.highDates)&&a.inArray(b._isoDate(b.theDate.getFullYear(),b.theDate.getMonth()+1,p.today),c.highDates)>-1?p.thisTheme=c.pickPageOHighButtonTheme:a.isArray(c.highDays)&&a.inArray(g,c.highDays)>-1?p.thisTheme=c.pickPageODHighButtonTheme:p.thisTheme=c.pickPageButtonTheme,a("<div>"+String(p.today)+"</div>").addClass("ui-datebox-griddate ui-corner-all").attr("data-date",c.calWeekMode?p.weekMode:p.today).attr("data-theme",p.thisTheme).appendTo(i).addClass("ui-btn-up-"+p.thisTheme).bind("vmouseover vmouseout",function(){c.calWeekMode!==!1&&c.calWeekModeHighlight===!0?a(this).parent().find("div").each(function(){b._hoover(this)}):b._hoover(this)}).bind(h?"error":"vclick",function(c){c.preventDefault(),b.theDate.setDate(a(this).attr("data-date")),b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"})}).css(h?"color":"nocolor",c.disabledDayColor),p.today++)}}},_create:function(){var b=this,c=a.extend(this.options,this.element.data("options")),d=this.element,e=d.wrap('<div class="ui-input-datebox ui-shadow-inset ui-corner-all ui-body-'+c.theme+'"></div>').parent(),f=new Date,g=new Date(f.getTime()),h=c.titleDialogLabel===!1?c.mode==="timebox"?c.titleTimeDialogLabel:c.titleDateDialogLabel:c.titleDialogLabel,i=a('<a href="#" class="ui-input-clear" title="date picker">date picker</a>').bind("vclick",function(d){d.preventDefault(),c.disabled||b.input.trigger("datebox",{method:"open"}),setTimeout(function(){a(d.target).closest("a").removeClass(a.mobile.activeBtnClass)},300)}).appendTo(e).buttonMarkup({icon:"grid",iconpos:"notext",corners:!0,shadow:!0}).css({"vertical-align":"middle","float":"right"}),j=d.closest(".ui-page"),k=a("<div data-role='dialog' class='ui-dialog-datebox' data-theme='"+c.pickPageTheme+"' >"+"<div data-role='header' data-backbtn='false' data-theme='a'>"+"<div class='ui-title'>"+h+"</div>"+"</div>"+"<div data-role='content'></div>"+"</div>").appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",c.zindex).addClass("pop"),l=k.find(".ui-content"),m="ontouchstart"in window,n=m?"touchstart":"mousedown",o=m?"touchmove":"mousemove",p=m?"touchend":"mouseup",q=!1,r=!1,s=!1,t=!1,u=!1,v=0;c.defaultPickerValue===!1&&c.defaultDate!==!1&&(c.defaultPickerValue=c.defaultDate),a("label[for="+d.attr("id")+"]").addClass("ui-input-text").css("verticalAlign","middle"),c.mode==="timeflipbox"&&(c.headerFormat=" "),c.timeOutput===!1&&(c.timeOutput=c.timeFormats[c.timeFormat]);if(c.fieldsOrder===!1)switch(c.mode){case"timebox":case"timeflipbox":c.fieldsOrder=c.timeFieldOrder;break;case"slidebox":c.fieldsOrder=c.slideFieldOrder;break;default:c.fieldsOrder=c.dateFieldOrder}(c.noButtonFocusMode||c.useInline||c.noButton)&&i.hide(),e.bind("vclick",function(){!c.disabled&&c.noButtonFocusMode&&d.trigger("datebox",{method:"open"})}),d.removeClass("ui-corner-all ui-shadow-inset").focus(function(){c.disabled||(e.addClass("ui-focus"),c.noButtonFocusMode&&(e.addClass("ui-focus"),d.trigger("datebox",{method:"open"}))),d.removeClass("ui-focus")}).blur(function(){e.removeClass("ui-focus"),d.removeClass("ui-focus")}).change(function(){b.theDate=b._makeDate(b.input.val()),b._update()}),d.bind("datebox",b._dateboxHandler),k.find(".ui-header a").bind("vclick",function(a){a.preventDefault(),a.stopImmediatePropagation(),b.input.trigger("datebox",{method:"close"})}),a.extend(b,{pickPage:k,thisPage:j,pickPageContent:l,input:d,theDate:f,initDate:g,focusedEl:e,touch:m,START_DRAG:n,MOVE_DRAG:o,END_DRAG:p,dragMove:q,dragStart:r,dragEnd:s,dragPos:t}),typeof a.event.special.mousewheel!="undefined"&&(c.wheelExists=!0),b._buildPage(),c.swipeEnabled&&(a(document).bind(b.MOVE_DRAG,function(a){if(b.dragMove){if(c.mode==="slidebox")return b.dragEnd=b.touch?a.originalEvent.changedTouches[0].pageX:a.pageX,b.dragTarget.css("marginLeft",b.dragPos+b.dragEnd-b.dragStart+"px"),a.preventDefault(),a.stopPropagation(),!1;if(c.mode==="flipbox"||c.mode==="timeflipbox")return b.dragEnd=b.touch?a.originalEvent.changedTouches[0].pageY:a.pageY,b.dragTarget.css("marginTop",b.dragPos+b.dragEnd-b.dragStart+"px"),a.preventDefault(),a.stopPropagation(),!1;if(c.mode==="durationbox"||c.mode==="timebox"||c.mode==="datebox")return b.dragEnd=b.touch?a.originalEvent.changedTouches[0].pageY:a.pageY,(b.dragEnd-b.dragStart)%2===0&&(v=(b.dragEnd-b.dragStart)/-2,v<b.dragPos?b._offset(b.dragTarget,-1*(b.dragTarget==="i"?c.minuteStep:1)):v>b.dragPos&&b._offset(b.dragTarget,1*(b.dragTarget==="i"?c.minuteStep:1)),b.dragPos=v),a.preventDefault(),a.stopPropagation(),!1}}),a(document).bind(b.END_DRAG,function(a){if(b.dragMove){b.dragMove=!1;if(c.mode==="slidebox"){if(b.dragEnd!==!1&&Math.abs(b.dragStart-b.dragEnd)>25){a.preventDefault(),a.stopPropagation();switch(b.dragTarget.parent().data("rowtype")){case"y":b._offset("y",parseInt((b.dragStart-b.dragEnd)/84,10));break;case"m":b._offset("m",parseInt((b.dragStart-b.dragEnd)/51,10));break;case"d":b._offset("d",parseInt((b.dragStart-b.dragEnd)/32,10));break;case"h":b._offset("h",parseInt((b.dragStart-b.dragEnd)/32,10));break;case"i":b._offset("i",parseInt((b.dragStart-b.dragEnd)/32,10))}}}else(c.mode==="flipbox"||c.mode==="timeflipbox")&&b.dragEnd!==!1&&(a.preventDefault(),a.stopPropagation(),b._offset(b.dragTarget.parent().parent().data("field"),parseInt((b.dragStart-b.dragEnd)/30,10)));b.dragStart=!1,b.dragEnd=!1}})),d.is(":disabled")&&b.disable(),c.disableManualInput===!0&&d.attr("readonly",!0)},_buildPage:function(){var b=this,c=b.options,d,e,f,g=a("<div><a href='#'></a></div>"),h=a("<div>",{"class":"ui-datebox-container ui-overlay-shadow ui-corner-all ui-datebox-hidden pop ui-body-"+c.pickPageTheme}).css("zIndex",c.zindex),i=a("<input type='text' />").addClass("ui-input-text ui-corner-all ui-shadow-inset ui-datebox-input ui-body-"+c.pickPageInputTheme),j=a("<div>",{"class":"ui-datebox-controls"}),k=a("<div class='ui-overlay-shadow'><ul></ul></div>"),l,m,n,o,p,q,r,s,t,u,v,w,x=!1,y=!1,z=a("<div>",{"class":"ui-datebox-screen ui-datebox-hidden"+(c.useModal?" ui-datebox-screen-modal":"")}).css({"z-index":c.zindex-1}).appendTo(b.thisPage).bind("vclick",function(a){a.preventDefault(),b.input.trigger("datebox",{method:"close"})});c.noAnimation&&h.removeClass("pop");if(c.mode==="flipbox"||c.mode==="timeflipbox"){p=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(h).find("h4"),m=a("<div>",{"class":"ui-datebox-flipcontent"}).appendTo(h),l=a("<div>",{"class":"ui-datebox-flipcenter ui-overlay-shadow"}).appendTo(h),o=j.clone().appendTo(h),u=k.clone().attr("data-field","d"),t=k.clone().attr("data-field","m"),v=k.clone().attr("data-field","y"),q=k.clone().attr("data-field","h"),r=k.clone().attr("data-field","i"),s=k.clone().attr("data-field","a"),c.wheelExists&&(v.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("y",c<0?-1:1)}),t.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("m",c<0?-1:1)}),u.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("d",c<0?-1:1)}),q.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("h",c<0?-1:1)}),r.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("i",(d<0?-1:1)*c.minuteStep)}),s.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("a",c)}),l.bind("mousewheel",function(d,e){d.preventDefault(),c.fieldsOrder.length===3?f=c.fieldsOrder[parseInt((d.pageX-a(d.currentTarget).offset().left)/87,10)]:c.fieldsOrder.length===2&&(f=c.fieldsOrder[parseInt((d.pageX-a(d.currentTarget).offset().left)/130,10)]),b._offset(f,(e<0?-1:1)*(f==="i"?c.minuteStep:1))}));for(d=0;d<=c.fieldsOrder.length;d++)c.fieldsOrder[d]==="y"&&v.appendTo(m),c.fieldsOrder[d]==="m"&&t.appendTo(m),c.fieldsOrder[d]==="d"&&u.appendTo(m),c.fieldsOrder[d]==="h"&&q.appendTo(m),c.fieldsOrder[d]==="i"&&
r.appendTo(m),c.fieldsOrder[d]==="a"&&c.timeFormat===12&&s.appendTo(m);c.swipeEnabled&&(m.find("ul").bind(b.START_DRAG,function(c,d){b.dragMove||(typeof d!="undefined"&&(c=d),b.dragMove=!0,b.dragTarget=a(this).find("li").first(),b.dragPos=parseInt(b.dragTarget.css("marginTop").replace(/px/i,""),10),b.dragStart=b.touch?c.originalEvent.changedTouches[0].pageY:c.pageY,b.dragEnd=!1,c.stopPropagation(),c.preventDefault())}),l.bind(b.START_DRAG,function(d){b.dragMove||(b.dragTarget=b.touch?d.originalEvent.changedTouches[0].pageX-a(d.currentTarget).offset().left:d.pageX-a(d.currentTarget).offset().left,c.fieldsOrder.length===3?a(b.controlsInput.find("ul").get(parseInt(b.dragTarget/87,10))).trigger(b.START_DRAG,d):c.fieldsOrder.length===2&&a(b.controlsInput.find("ul").get(parseInt(b.dragTarget/130,10))).trigger(b.START_DRAG,d))})),c.noSetButton===!1&&a("<a href='#'>"+(c.mode==="timeflipbox"?c.setTimeButtonLabel:c.setDateButtonLabel)+"</a>").appendTo(o).buttonMarkup({theme:c.pickPageTheme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),c.mode==="timeflipbox"?b.input.trigger("datebox",{method:"set",value:b._formatTime(b.theDate)}):b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"})}),a.extend(b,{controlsHeader:p,controlsInput:m,pickerDay:u,pickerMon:t,pickerYar:v,pickerHour:q,pickerMins:r,pickerMeri:s}),h.appendTo(b.thisPage)}if(c.mode==="durationbox"){l=j.clone().removeClass("ui-datebox-controls").addClass("ui-datebox-scontrols").appendTo(h),m=l.clone().appendTo(h),n=l.clone().appendTo(h),o=j.clone().appendTo(h),u=i.removeClass("ui-datebox-input").clone().keyup(function(){a(this).val()!==""&&b._updateduration()}),q=u.clone().keyup(function(){a(this).val()!==""&&b._updateduration()}),r=u.clone().keyup(function(){a(this).val()!==""&&b._updateduration()}),w=u.clone().keyup(function(){a(this).val()!==""&&b._updateduration()}),c.wheelExists&&(u.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("d",(d<0?-1:1)*c.durationSteppers.d)}),q.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("h",(d<0?-1:1)*c.durationSteppers.h)}),r.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("i",(d<0?-1:1)*c.durationSteppers.i)}),w.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("s",(d<0?-1:1)*c.durationSteppers.s)}));for(d=0;d<c.durationOrder.length;d++)switch(c.durationOrder[d]){case"d":a("<div>",{"class":"ui-datebox-sinput","data-field":"d"}).append(u).appendTo(m).prepend("<label>"+c.durationLabel[0]+"</label>");break;case"h":a("<div>",{"class":"ui-datebox-sinput","data-field":"h"}).append(q).appendTo(m).prepend("<label>"+c.durationLabel[1]+"</label>");break;case"i":a("<div>",{"class":"ui-datebox-sinput","data-field":"i"}).append(r).appendTo(m).prepend("<label>"+c.durationLabel[2]+"</label>");break;case"s":a("<div>",{"class":"ui-datebox-sinput","data-field":"s"}).append(w).appendTo(m).prepend("<label>"+c.durationLabel[3]+"</label>")}c.swipeEnabled&&m.find("input").bind(b.START_DRAG,function(c){b.dragMove||(b.dragMove=!0,b.dragTarget=a(this).parent().data("field"),b.dragPos=0,b.dragStart=b.touch?c.originalEvent.changedTouches[0].pageY:c.pageY,b.dragEnd=!1,c.stopPropagation())}),c.noSetButton===!1&&a("<a href='#'>"+c.setDurationButtonLabel+"</a>").appendTo(o).buttonMarkup({theme:c.pickPageTheme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),b.input.trigger("datebox",{method:"set",value:b._formatTime(b.theDate)}),b.input.trigger("datebox",{method:"close"})});for(d=0;d<c.durationOrder.length;d++)g.clone().appendTo(l).buttonMarkup({theme:c.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:!0,shadow:!0}).attr("data-field",c.durationOrder[d]).bind("vclick",function(d){d.preventDefault(),b._offset(a(this).attr("data-field"),c.durationSteppers[a(this).attr("data-field")])}),g.clone().appendTo(n).buttonMarkup({theme:c.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:!0,shadow:!0}).attr("data-field",c.durationOrder[d]).bind("vclick",function(d){d.preventDefault(),b._offset(a(this).attr("data-field"),-1*c.durationSteppers[a(this).attr("data-field")])});a.extend(b,{pickerHour:q,pickerMins:r,pickerDay:u,pickerSecs:w}),h.appendTo(b.thisPage)}if(c.mode==="datebox"||c.mode==="timebox"){p=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(h).find("h4"),l=j.clone().appendTo(h),m=j.clone().appendTo(h),n=j.clone().appendTo(h),o=j.clone().appendTo(h),c.mode==="timebox"&&p.parent().html(""),t=i.clone().attr("data-field","m").keyup(function(){a(this).val()!==""&&b._isInt(a(this).val())&&(b.theDate.setMonth(parseInt(a(this).val(),10)-1),b._update())}),u=t.clone().attr("data-field","d").keyup(function(){a(this).val()!==""&&b._isInt(a(this).val())&&(b.theDate.setDate(parseInt(a(this).val(),10)),b._update())}),v=t.clone().attr("data-field","y").keyup(function(){a(this).val()!==""&&b._isInt(a(this).val())&&(b.theDate.setFullYear(parseInt(a(this).val(),10)),b._update())}),q=i.clone().attr("data-field","h").keyup(function(){a(this).val()!==""&&b._isInt(a(this).val())&&(e=parseInt(a(this).val(),10),e===12&&c.timeFormat===12&&s.val()===c.meridiemLetters[0]&&(e=0),b.theDate.setHours(e),b._update())}),r=i.clone().attr("data-field","i").keyup(function(){a(this).val()!==""&&b._isInt(a(this).val())&&(b.theDate.setMinutes(parseInt(a(this).val(),10)),b._update())}),s=i.clone().attr("data-field","a").keyup(function(){a(this).val()!==""&&b._update()}),c.wheelExists&&(v.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("y",c<0?-1:1)}),t.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("m",c<0?-1:1)}),u.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("d",c<0?-1:1)}),q.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("h",c<0?-1:1)}),r.bind("mousewheel",function(a,d){a.preventDefault(),b._offset("i",(d<0?-1:1)*c.minuteStep)}),s.bind("mousewheel",function(a,c){a.preventDefault(),b._offset("a",c)}));for(d=0;d<=c.fieldsOrder.length;d++)c.fieldsOrder[d]==="y"&&v.appendTo(m),c.fieldsOrder[d]==="m"&&t.appendTo(m),c.fieldsOrder[d]==="d"&&u.appendTo(m),c.fieldsOrder[d]==="h"&&q.appendTo(m),c.fieldsOrder[d]==="i"&&r.appendTo(m),c.fieldsOrder[d]==="a"&&c.timeFormat===12&&s.appendTo(m);c.swipeEnabled&&m.find("input").bind(b.START_DRAG,function(c){b.dragMove||(b.dragMove=!0,b.dragTarget=a(this).data("field"),b.dragPos=0,b.dragStart=b.touch?c.originalEvent.changedTouches[0].pageY:c.pageY,b.dragEnd=!1,c.stopPropagation())}),c.noSetButton===!1&&a("<a href='#'>"+(c.mode==="timebox"?c.setTimeButtonLabel:c.setDateButtonLabel)+"</a>").appendTo(o).buttonMarkup({theme:c.pickPageTheme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),c.mode==="timebox"?b.input.trigger("datebox",{method:"set",value:b._formatTime(b.theDate)}):b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"})});for(d=0;d<b.options.fieldsOrder.length;d++)if(c.fieldsOrder[d]!=="a"||c.timeFormat===12)g.clone().appendTo(l).buttonMarkup({theme:c.pickPageButtonTheme,icon:"plus",iconpos:"bottom",corners:!0,shadow:!0}).attr("data-field",c.fieldsOrder[d]).bind("vclick",function(d){d.preventDefault(),b._offset(a(this).attr("data-field"),1*(a(this).attr("data-field")==="i"?c.minuteStep:1))}),g.clone().appendTo(n).buttonMarkup({theme:c.pickPageButtonTheme,icon:"minus",iconpos:"top",corners:!0,shadow:!0}).attr("data-field",c.fieldsOrder[d]).bind("vclick",function(d){d.preventDefault(),b._offset(a(this).attr("data-field"),-1*(a(this).attr("data-field")==="i"?c.minuteStep:1))});a.extend(b,{controlsHeader:p,pickerDay:u,pickerMon:t,pickerYar:v,pickerHour:q,pickerMins:r,pickerMeri:s}),h.appendTo(b.thisPage)}c.mode==="calbox"&&(p=a("<div>",{"class":"ui-datebox-gridheader"}).appendTo(h),o=a("<div>",{"class":"ui-datebox-grid"}).appendTo(h),m=a("<div class='ui-datebox-gridlabel'><h4>Uninitialized</h4></div>").appendTo(p).find("h4"),c.swipeEnabled&&h.bind("swipeleft",function(){b.calNoNext||b._offset("m",1)}).bind("swiperight",function(){b.calNoPrev||b._offset("m",-1)}),c.wheelExists&&h.bind("mousewheel",function(a,c){a.preventDefault(),c>0&&!b.calNoNext&&(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",1)),c<0&&!b.calNoPrev&&(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",-1))}),a("<div class='ui-datebox-gridplus'><a href='#'>Next Month</a></div>").prependTo(p).buttonMarkup({theme:c.pickPageButtonTheme,icon:"plus",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),b.calNoNext||(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",1))}),a("<div class='ui-datebox-gridminus'><a href='#'>Prev Month</a></div>").prependTo(p).buttonMarkup({theme:c.pickPageButtonTheme,icon:"minus",inline:!0,iconpos:"notext",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),b.calNoPrev||(b.theDate.getDate()>28&&b.theDate.setDate(1),b._offset("m",-1))}),c.calTodayButton===!0&&a("<a href='#'>"+c.calTodayButtonLabel+"</a>").appendTo(h).buttonMarkup({theme:c.pickPageTheme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),b.theDate=new Date,b.theDate=new Date(b.theDate.getFullYear(),b.theDate.getMonth(),b.theDate.getDate(),0,0,0,0),b.input.trigger("datebox",{method:"doset"})}),a.extend(b,{controlsInput:m,controlsSet:o,calNoNext:x,calNoPrev:y}),h.appendTo(b.thisPage)),c.mode==="slidebox"&&(p=a("<div class='ui-datebox-header'><h4>Unitialized</h4></div>").appendTo(h).find("h4"),m=a("<div>").addClass("ui-datebox-slide").appendTo(h),o=a("<div>",{"class":"ui-datebox-controls"}).appendTo(h),c.noSetButton===!1&&a("<a href='#'>"+c.setDateButtonLabel+"</a>").appendTo(o).buttonMarkup({theme:c.pickPageTheme,icon:"check",iconpos:"left",corners:!0,shadow:!0}).bind("vclick",function(a){a.preventDefault(),b.input.trigger("datebox",{method:"set",value:b._formatDate(b.theDate)}),b.input.trigger("datebox",{method:"close"})}),a.extend(b,{controlsHeader:p,controlsInput:m}),h.appendTo(b.thisPage)),a.extend(b,{pickerContent:h,screen:z}),c.useInline&&(b.input.parent().parent().append(b.pickerContent),c.useInlineHideInput&&b.input.parent().hide(),b.input.trigger("change"),b.pickerContent.removeClass("ui-datebox-hidden"))},refresh:function(){this.options.useInline===!0&&this.input.trigger("change"),this._update()},open:function(){if(this.options.useInline)return!1;if(this.pickPage.is(":visible"))return!1;this.input.trigger("change").blur();var b=this,c=this.options,d=b.focusedEl.offset(),e=b.pickerContent.outerHeight(),f=b.pickerContent.innerWidth(),g=d.top+b.focusedEl.outerHeight()/2-e/2,h=d.left+b.focusedEl.outerWidth()/2-f/2,i;h+f>a(document).width()&&(h=a(document).width()-f-1),h<0&&(h=0),c.centerWindow&&(h=a(document).width()/2-f/2),e+g>a(document).height()&&(g=a(document).height()-(e+2)),g<45&&(g=45),a(document).width()>400&&!c.useDialogForceTrue||c.useDialogForceFalse?(c.useDialog=!1,c.nestedBox&&(e===0&&(e=250,g=d.top+b.focusedEl.outerHeight()/2-e/2),i=a(".ui-page-active").first(),a(i).append(b.pickerContent),a(i).append(b.screen)),c.useModal?b.screen.fadeIn("slow"):b.screen.removeClass("ui-datebox-hidden"),b.pickerContent.addClass("ui-overlay-shadow in").css({position:"absolute",top:g,left:h}).removeClass("ui-datebox-hidden")):(b.thisPage.unbind("pagehide.remove"),c.useDialog=!0,b.pickPageContent.append(b.pickerContent),b.pickerContent.css({top:"auto",left:"auto",marginLeft:"auto",marginRight:"auto"}).removeClass("ui-overlay-shadow ui-datebox-hidden"),a.mobile.changePage(b.pickPage,{transition:"pop"}))},close:function(){var b=this,c;if(b.options.useInline)return!0;b.options.useDialog?(a(b.pickPage).dialog("close"),b.thisPage.data("page").options.domCache||b.thisPage.bind("pagehide.remove",function(){a(this).remove()}),b.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",b.options.zindex),b.thisPage.append(b.pickerContent)):(b.options.useModal?b.screen.fadeOut("slow"):b.screen.addClass("ui-datebox-hidden"),b.pickerContent.addClass("ui-datebox-hidden").removeAttr("style").css("zIndex",b.options.zindex).removeClass("in")),b.focusedEl.removeClass("ui-focus"),b.options.closeCallback!==!1&&(c=new Function(b.options.closeCallback),c())},disable:function(){this.element.attr("disabled",!0),this.element.parent().addClass("ui-disabled"),this.options.disabled=!0,this.element.blur(),this.input.trigger("datebox",{method:"disable"})},enable:function(){this.element.attr("disabled",!1),this.element.parent().removeClass("ui-disabled"),this.options.disabled=!1,this.input.trigger("datebox",{method:"enable"})}}),a(document).bind("pagebeforecreate",function(b){a(":jqmData(role='datebox')",b.target).each(function(){a(this).replaceWith(a("<div>").html(a(this).clone()).html().replace(/\s+type=["']date['"]?/,' type="text" '))})}),a(document).bind("pagecreate",function(b){a(":jqmData(role='datebox')",b.target).datebox()})})(jQuery)